name: Update Calendar

# 触发器修改为手动执行
on:
  workflow_dispatch:  # 允许手动触发工作流
    inputs:
      update:
        description: 'Update calendar data'
        required: true
        default: 'true'

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install dependencies
        run: npm install

      - name: Run the data fetch and ICS generation script
        run: |
          if [ "${{ github.event.inputs.update }}" == "true" ]; then
            node scripts/fetch-data.js
            node scripts/generate-ics.js
          else
            echo "Skipping the update."
          fi

      - name: Commit and push the updated files
        uses: EndBug/add-and-commit@v7
        with:
          author_name: 'GitHub Actions'
          author_email: 'github-actions@users.noreply.github.com'
          message: 'Update data.json and calendar.ics'